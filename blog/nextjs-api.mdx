---
title: Next.js API
author: "Dongha Kang"
date: "2022-05-24"
tag: ["Next.js"]
---

# Next.js API

Ïñ¥ÎñªÍ≤å Î≥¥Î©¥ Next.js Îäî FullstackÏúºÎ°úÎèÑ ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎäî Í≤É Í∞ôÎã§..

Ïù¥Îäî Next.js ÏÉÅÏóêÏÑú APIÎ•º ÎßåÎì§ Ïàò ÏûàÍ∏∞ ÎïåÎ¨∏Ïù∏Îç∞.. Í∞ÑÎã®ÌïòÍ≤å 

## Í∞ÑÎã®ÌïòÍ≤å!

```
# folder structure
/pages 
‚îî‚îÄ‚îÄ /api
		‚îî‚îÄ‚îÄ hello.ts
```

```jsx
export default function handler(req, res) {
	res.status(200).json({ name : 'Home API route' })
}
```

Îã§Ïãú ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ ÌïòÍ≥† Ïã§ÌñâÏùÑ ÌïúÎí§ [localhost:3000/api/hello](http://localhost:3000/api/hello) Î•º Îì§Ïñ¥Í∞ÑÎã§Î©¥, apiÎ•º ÌôïÏù∏ Ìï† Ïàò ÏûàÍ≤å ÎêúÎã§.

Ï∞∏ ÏâΩÏ£†?

## GET

Î≤ÑÌäºÏùÑ ÎàÑÎ•∏Îí§Ïóê API requestÍ∞Ä Ïò§Í≥† Í∞ÄÎäî Í≤ΩÏö∞Í∞Ä Îçî ÎßéÎã§. Í∑∏Îü∞Í≤ΩÏö∞Ïóê GET, POSTÎ•º ÏÇ¨Ïö©Ìï¥ÏïºÌïòÎäîÎç∞ ÏÇ¨Ïö©Î∞©Î≤ïÏùÄ Ïù¥ÏôÄÍ∞ôÎã§.

```jsx
// pages/api/hello.ts
import data from '../../data';

export default function handler(req, res) {
	res.status(200).json(data);
}
```

ÏïÑÎûòÎäî Í∑∏ API ÌÜµÏã†ÏùÑ ÌïòÎäî Î≤ÑÌäºÏù¥ ÏûàÎäî ÌéòÏù¥ÏßÄÎùºÍ≥† Í∞ÄÏ†ïÌïòÏûê.

```jsx
// pages/index.ts

const Home: NextPage = () => {
	const [d, setData] = useState([])

	const fetchData = async () => {
		const response = await fetch('/api/hello')
		const data = await response.json()
		setData(data);
	}	

	return (
		<>
			<button onClick={fetchData}>Click to GET</button>
			{/*...DO SOMETHING WITH FETCHED DATA */}
		</>
	)
}
```

ÏúÑÏôÄ Í∞ôÏù¥ fetchData ÎùºÎäî async Îç∞Ïù¥ÌÑ∞Î•º ÎßåÎì§Í≥† Ï£ºÏÜå Í∞ôÏùÄ Í≤ΩÏö∞ Í∏∞Ï°¥Ïóê Ïö∞Î¶¨Í∞Ä ÎßåÎì† ÌÜµÏã† Ï£ºÏÜåÎ•º ÏÇ¨Ïö©Ìï¥ÏÑú Î∞îÎ°ú ÏÇ¨Ïö©Ìï† Ïàò ÏûàÎã§.

## POST

ÏúÑÏôÄ ÎèôÏùºÌïú Î∞©ÏãùÏúºÎ°ú ÏßÑÌñâÏù¥ ÎêòÏßÄÎßå API Ï∏°ÏóêÏÑú ÏÇ¥Ïßù Îã§Î•¥Îã§. ÏòàÏãúÎ°ú Î≥¥Ïûê

```jsx
// pages/api/hello.ts
import data from '../../data';

export default function handler(req, res) {
	if (req.method === 'GET') {
		// Î©îÏÑúÎìúÍ∞Ä GETÏù¥ÎùºÎ©¥...
		res.status(200).json(data);
	} else {
		const comment = req.body.str // Î∞ëÏóê ÏòàÏãúÏóêÏÑú ÌëúÏãúÌïú body Í∞Ä Ïó¨Í∏∞Ïóê Îì§Ïñ¥Í∞ÑÎã§
		const newComment = {
			id: Date.now(),
			text: str
		}		
		data.push(newComment)
		res.status(201).json(data)   // 201 response
	}
}
```

```jsx
// pages/index.ts

const Home: NextPage = () => {
	const [str, setStr] = useState('')
	const [d, setData] = useState([])

	const fetchData = async () => {
		// ...
	}	

	const submitData = async () => {
		const response = await fetch('/api/hello', {
			method: 'POST',
			body: JSON.stringify({str}),
			headers: {
				'Content-Type': 'application/json',
			}
		})
		const data = await response.json()
		console.log(data)
	}

	return (
		<>
			<input type='text' value={str} onChange={e => setStr(e.target.value)}/>
			{/*...DO SOMETHING WITH NEW TEXT */}
			<button onClick={fetchData}>Click to GET</button>
			{/*...DO SOMETHING WITH FETCHED DATA */}
		</>
	)
}
```

## ÎèôÏ†Å API ÎùºÏö∞ÌåÖ

[localhost:3000/api/hello?dataId=20](http://localhost:3000/api/hello?dataId=20) Ïù¥Îü∞ÏãùÏùò ÎèôÏ†Å ÎùºÏö∞ÌåÖÏùÄ Ïñ¥ÎñªÍ≤å ÌïòÎ©¥ Îê†Íπå? 

Îã§Î•∏ Next.jsÏùò ÌéòÏù¥ÏßÄ ÎèôÏ†Å ÎùºÏö∞ÌåÖÍ≥º ÎπÑÏä∑ÌïòÍ≤å [  ] ÏùÑ ÏÇ¨Ïö©Ìï¥ÏÑú ÌååÏùºÏùÑ ÏÉùÏÑúÌïòÎ©¥ ÎêúÎã§. `[dataId].tsx` Ïù¥Îü∞ÏãùÏúºÎ°ú 

Ïù¥Î•º Î∂àÎü¨Ïò¨ ÎïåÎäî ..

```jsx
// pages/api/hello.ts
import data from '../../data';

export default function handler(req, res) {
	const { dataId } = req.query
	const finalData = data.find(d => d.id === dataId)
	res.status(200).json(finalData);
}
```

ÏúÑÏôÄ Í∞ôÏù¥ Ìï¥Í≤∞ÌïòÎ©¥ ÎêúÎã§. 

## Catch All

ÏúÑÎäî ÎèôÏ†Å ÎùºÏö∞ÌåÖÏù¥ÏßÄÎßå ÎßåÏïΩÏóê ‚Ä¶ ÍπåÏßÄ Î∂ôÏù¥Î©¥ Ïñ¥ÎñªÍ≤å Îê†Íπå [‚Ä¶params].tsx

```jsx
// pages/api/[...params].tsx
export default function handler(req, res) {
	const params = req.query.params
	console.log(params)
	res.status(200).json(params)
}
```

‚û°Ô∏è¬†localhost:3000/api/one = [‚Äùone‚Äù]

‚û°Ô∏è¬†localhost:3000/api/one/two = [‚Äùone‚Äù, ‚Äútwo‚Äù]

‚û°Ô∏è¬†localhost:3000/api/one/two/three = [‚Äùone‚Äù, ‚Äútwo‚Äù, ‚Äúthree‚Äù]

P.S. [[‚Ä¶params]].tsx ÏùÄ Optional parameterÎ•º Î∞õÍ∏∞ÎèÑÌï¥ÏÑú [localhost:3000/api](http://localhost:3000/api) ÎèÑ (index.tsx Í∞Ä ÏóÜÎã§Îäî Í∞ÄÏ†ïÌïòÏóê) undefinedÎ•º Î∞õÍ≤å ÎêúÎã§.

---

## ÎÇ¥Í∞Ä ÎßûÏù¥Ìïú CORS Î¨∏Ï†ú

üí°¬†Ïô∏Î∂Ä api Í∞ôÏùÄ Í≤ΩÏö∞ Í∑∏ÎÉ• Î∞õÏïÑÏò§Î©¥ ÎêòÏßÄÎßå, Nest Î•º ÏÇ¨Ïö©ÌïòÍ±∞ÎÇò localhostÏóêÏÑú Í∞ôÏùÄ Ìè¨Ìä∏ Ïô∏Ïùò APIÎ•º Í∞ÄÏ†∏Ïò®Îã§Î©¥ Ï£ºÎ°ú Ïù¥Îü∞ ÏóêÎü¨Î•º ÎßéÏù¥ Î¥§ÏóàÏùÑÌÖêÎç∞‚Ä¶

> üö® Access to fetch at ‚ÄúAPI‚Äù from origin ‚Äò[http://localhost:3000](http://localhost:3000/)‚Äô has been blocked by CORS policy: No ‚ÄòAccess-Control-Allow-Origin‚Äô header is present on the requested resource. If an opaque response serves your needs, set the request‚Äôs mode to ‚Äòno-cors‚Äô to fetch the resource with CORS disabled.
> 

Ïù¥Îü∞ Í≤ΩÏö∞ÏóêÎäî next.config.js Î•º ÏóÖÎç∞Ïù¥Ìä∏ Ìï¥ÏïºÌïúÎã§.

```jsx
//next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  async rewrites() {
    return [
      {
        source: '/api/:path*',
        destination: `APIÏ£ºÏÜå/:path*`,
      },
    ];
  },
};

module.exports = nextConfig;
```

[`rewrites`](https://nextjs.org/docs/api-reference/next.config.js/rewrites) functionÏùÄ Îì§Ïñ¥Ïò§Îäî request pathÎ•º ÏÉàÎ°úÏö¥ destination pathÎ°ú Î≥¥ÎÇ¥Î≤ÑÎ¶¨(?)Îäî Í±∞Îã§. ÎòêÌïú URL proxy Ï≤òÎüº ÏùºÏùÑ ÌïòÍ∏∞ÎèÑ ÌïúÎã§.

Í∑∏ ÌõÑ ÎÇòÏ§ëÏóê API Îäî Í∏∞Ï°¥Ïóê ÏÇ¨Ïö©Ìïú Î∞©ÏãùÏúºÎ°ú

```jsx
fetch('http://localhost:3000/api').then(res => res.json()) ...
```

ÏÇ¨Ïö©ÌïòÎ©¥ ÎêúÎã§.